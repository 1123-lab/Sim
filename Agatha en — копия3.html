<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Simulation Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .decision-btn, .action-btn {
            transition: background-color 0.3s, transform 0.2s;
        }
        .decision-btn:hover, .action-btn:hover {
            transform: translateY(-2px);
        }
        .decision-btn.selected {
            background-color: #b91c1c; /* Darker Red */
            color: white;
            cursor: default;
        }
        .decision-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        #consequence-box, #score-box, #next-phase-btn, #end-game-message {
            transition: opacity 0.5s, transform 0.5s;
        }
        .crew-icon {
            width: 24px;
            height: 24px;
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
        }
        .crew-icon.alive {
            stroke: #000000; /* Black */
        }
        .crew-icon.unknown {
            stroke: #f59e0b; /* Amber/Yellow */
        }
        .crew-icon.deceased {
            stroke: #6b7280; /* Gray */
        }
        .cross {
            stroke: #ef4444; /* Red */
            stroke-width: 3;
            stroke-linecap: round;
            display: none; /* Hidden by default */
        }
        .crew-icon.deceased .cross {
            display: block; /* Shown when deceased */
        }
        #phase-image {
            max-height: 300px;
            object-fit: contain;
            width: 100%;
            border-radius: 0.5rem;
            margin-top: 1rem;
            background: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-10">
        
        <!-- Start Page -->
        <div id="start-page" class="text-center space-y-8">
             <h1 class="text-3xl md:text-4xl font-bold text-gray-900">INCIDENT ONBOARD ACCOMMODATION VESSEL 'AGATHA'</h1>
            <div class="bg-gray-100 p-4 rounded-lg text-left">
                <h2 class="text-xl font-bold text-gray-800 mb-2">PREHISTORY</h2>
                <p class="text-gray-700">The simulation you are about to start is based on a real incident that unfolded 20 years ago, on the real vessel with the same number of crew aboard, but i[...]</p>
            </div>
            <div class="bg-red-50 p-6 rounded-lg text-left">
                <h2 class="text-xl font-bold text-red-800 mb-2">TASK FOR SIMULATION</h2>
                <p class="text-red-800 leading-relaxed text-lg">
                    You are the Captain of the vessel 'Agatha'. Your objective is to navigate through the nine phases of a developing emergency. At each phase, you will be presented with a scenari[...]
                </p>
            </div>
            <button class="action-btn bg-red-600 text-white font-bold py-3 px-10 rounded-lg shadow-md hover:bg-red-700" onclick="startSimulation()">
                Start Simulation
            </button>
        </div>

        <!-- Simulation Page -->
        <div id="simulation-page" class="hidden space-y-8">
            <!-- Header Section -->
            <div class="text-center border-t pt-6">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Simulation of Incident</h2>
                <p id="phase-title" class="text-2xl text-red-600 font-semibold mt-2"></p>
            </div>

            <!-- Scenario Section -->
            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Scenario Setup:</h3>
                <div class="bg-gray-50 border-l-4 border-red-500 p-4 rounded-r-lg">
                    <p id="scenario-text" class="text-lg text-gray-600 leading-relaxed"></p>
                </div>
            </div>

            <!-- Decision Section -->
            <div>
                <h3 id="decision-question" class="text-xl font-semibold text-gray-700 mb-4"></h3>
                <div id="decision-buttons" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
            </div>

            <!-- Consequence Section (Initially Hidden) -->
            <div id="consequence-box" class="hidden opacity-0 transform -translate-y-4">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Consequence:</h3>
                <div class="bg-orange-50 border-l-4 border-orange-500 p-5 rounded-r-lg shadow-inner">
                    <p id="consequence-text" class="text-gray-800 leading-relaxed"></p>
                </div>
            </div>
            
            <!-- Score Section (Initially Hidden) -->
            <div id="score-box" class="hidden opacity-0 transform -translate-y-4">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Score:</h3>
                 <div class="bg-gray-50 border-l-4 border-gray-400 p-5 rounded-r-lg shadow-inner space-y-4">
                    <div class="flex justify-between items-center">
                        <p><strong>Correct Decisions:</strong> <span id="correct-answer-status" class="font-bold text-green-600"></span></p>
                        <p><strong>Time Elapsed:</strong> <span id="time-lost" class="font-bold text-red-600"></span></p>
                    </div>
                    <div class="flex flex-wrap justify-between items-center gap-4">
                        <div class="flex items-center space-x-2">
                            <strong class="text-gray-700">Crew Status:</strong>
                            <div id="headcount-visual" class="flex space-x-1"></div>
                            <span id="headcount-text" class="font-bold text-gray-700"></span>
                        </div>
                         <p><strong>External Casualties:</strong> <span id="external-casualties-text" class="font-bold text-red-600">0</span></p>
                    </div>
                </div>
            </div>
        
            <!-- Next Phase Button (Initially Hidden) -->
            <div id="next-phase-container" class="text-center hidden">
                 <button id="next-phase-btn" class="action-btn bg-sky-500 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-sky-600" onclick="loadNextPhase()">
                    Next Phase
                </button>
            </div>
        </div>

        <!-- Final Score Page -->
        <div id="final-page" class="hidden text-center p-6 space-y-6">
            <h2 class="text-3xl font-bold text-green-600">Congratulations, you have completed the simulation.</h2>
            
            <div class="bg-gray-100 p-6 rounded-lg shadow-inner">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Your Final Score:</h3>
                <div class="flex flex-col items-center space-y-4">
                    <!-- Row 1: Casualties -->
                    <div class="flex flex-col md:flex-row justify-center items-center md:space-x-8 space-y-4 md:space-y-0">
                        <div class="flex items-center space-x-2">
                            <strong class="text-lg">Final Crew Status:</strong>
                            <div id="final-headcount-visual" class="flex space-x-1"></div>
                            <span id="final-headcount-text" class="font-bold text-gray-700 text-xl"></span>
                        </div>
                         <p class="text-lg"><strong>External Casualties:</strong> <span id="final-external-casualties-text" class="font-bold text-red-600 text-xl"></span></p>
                    </div>
                    <!-- Row 2: Score -->
                    <div class="flex flex-col md:flex-row justify-center items-center md:space-x-8 space-y-4 md:space-y-0">
                        <p class="text-lg"><strong>Correct Decisions:</strong> <span id="final-correct-decisions" class="font-bold text-green-600 text-xl"></span></p>
                        <p class="text-lg"><strong>Total Time Elapsed:</strong> <span id="final-time-lost" class="font-bold text-red-600 text-xl"></span></p>
                    </div>
                </div>
            </div>
            
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 text-left">
                 <p class="text-yellow-800">Do not worry - no one was injured or dead during the real incident with the fire in the provisional store 20 years ago.</p>
            </div>

            <p class="text-xl">The best decision in any incident is to prevent it.</p>
            <blockquote class="mt-4 italic text-xl border-l-4 border-gray-300 pl-4 text-gray-600">
                <p>"The little details are what is vital. Little things make big things happen."</p>
                <footer class="mt-1 text-sm">- Agatha Christie, *And Then There Were None*</footer>
            </blockquote>
             <button class="action-btn mt-6 bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-blue-700" onclick="restartGame()">
                Restart Simulation
            </button>
        </div>

    </div>

    <script>
        let currentPhaseIndex = 0;
        let totalTimeLost = 0;
        let totalDeceased = 0;
        let totalUnknown = 0;
        let totalExternalDeceased = 0;
        let correctDecisionsCount = 0;
        const totalCrew = 10;

        // --- [gamePhases array omitted for brevity; use your existing array here] ---

        function renderHeadcount(containerId, textContainerId, deceasedCount, unknownCount, crewTotal = totalCrew) {
            const container = document.getElementById(containerId);
            const textContainer = document.getElementById(textContainerId);
            container.innerHTML = '';
            
            const aliveCount = crewTotal - deceasedCount - unknownCount;

            for (let i = 0; i < crewTotal; i++) {
                let iconClass = 'crew-icon';
                if (i < deceasedCount) {
                    iconClass += ' deceased';
                } else if (i < deceasedCount + unknownCount) {
                    iconClass += ' unknown';
                } else {
                    iconClass += ' alive';
                }
                
                const iconHTML = `
                    <svg class="${iconClass}" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="6" r="2.5"/>
                        <path d="M12 8.5V15M7 11l5-3 5 3M9 19l3-4 3 4"/>
                        <line class="cross" x1="4" y1="4" x2="20" y2="20"/>
                    </svg>
                `;
                container.innerHTML += iconHTML;
            }
            if (textContainer) {
                 let statusString = `(${aliveCount}/${crewTotal} Alive`;
                 if (unknownCount > 0) {
                     statusString += `, ${unknownCount} Unknown`;
                 }
                 statusString += ')';
                 textContainer.textContent = statusString;
            }
        }

        function showConsequence(decisionKey) {
            const phase = gamePhases[currentPhaseIndex];
            const decision = phase.decisions[decisionKey];

            if (decisionKey === phase.correct) {
                correctDecisionsCount++;
            }

            totalTimeLost += decision.time;
            totalDeceased += decision.deceased;
            totalUnknown += decision.unknown;
            totalExternalDeceased += decision.externalDeceased;

            // Show fullscreen image overlay for 5 seconds if there's an image
            if (phase.image) {
                const overlay = document.getElementById('fullscreen-image-overlay');
                const img = document.getElementById('fullscreen-phase-image');
                img.src = phase.image;
                overlay.style.display = 'flex';

                setTimeout(() => {
                    overlay.style.display = 'none';
                    showConsequenceDetails(decisionKey, phase, decision);
                }, 5000);
            } else {
                showConsequenceDetails(decisionKey, phase, decision);
            }
        }

        function showConsequenceDetails(decisionKey, phase, decision) {
            document.getElementById('consequence-text').innerHTML = decision.consequence;
            document.getElementById('time-lost').textContent = `${totalTimeLost} minutes`;
            document.getElementById('correct-answer-status').textContent = `${correctDecisionsCount} of ${gamePhases.length}`;

            renderHeadcount('headcount-visual', 'headcount-text', totalDeceased, totalUnknown);
            document.getElementById('external-casualties-text').textContent = `(${totalExternalDeceased})`;

            const consequenceBox = document.getElementById('consequence-box');
            const scoreBox = document.getElementById('score-box');

            consequenceBox.classList.remove('hidden');
            scoreBox.classList.remove('hidden');

            setTimeout(() => {
                consequenceBox.classList.remove('opacity-0', '-translate-y-4');
                scoreBox.classList.remove('opacity-0', '-translate-y-4');
            }, 10);

            document.querySelectorAll('.decision-btn').forEach(button => {
                button.disabled = true;
                if (button.id === `btn${decisionKey}`) {
                    button.classList.add('selected');
                }
            });

            // Only now show and configure the Next Phase/Final Score button
            const nextButton = document.getElementById('next-phase-btn');
            const nextContainer = document.getElementById('next-phase-container');
            nextContainer.classList.remove('hidden');
            if (currentPhaseIndex < gamePhases.length - 1) {
                nextButton.textContent = 'Next Phase';
                nextButton.onclick = loadNextPhase;
            } else {
                nextButton.textContent = 'Final Score';
                nextButton.onclick = showFinalScore;
            }
        }

        function showFinalScore() {
            document.getElementById('simulation-page').classList.add('hidden');
            const finalPage = document.getElementById('final-page');
            
            document.getElementById('final-correct-decisions').textContent = `${correctDecisionsCount} of ${gamePhases.length}`;
            document.getElementById('final-time-lost').textContent = `${totalTimeLost} minutes`;
            renderHeadcount('final-headcount-visual', 'final-headcount-text', totalDeceased, totalUnknown);
            document.getElementById('final-external-casualties-text').textContent = `(${totalExternalDeceased})`;

            finalPage.classList.remove('hidden');
        }

        function loadPhase(phaseIndex) {
            const phase = gamePhases[phaseIndex];
            document.getElementById('phase-title').textContent = phase.title;
            document.getElementById('scenario-text').innerHTML = phase.scenario;
            document.getElementById('decision-question').textContent = phase.question;

            const buttonsContainer = document.getElementById('decision-buttons');
            buttonsContainer.innerHTML = '';

            for (const key in phase.decisions) {
                const decision = phase.decisions[key];
                const button = document.createElement('button');
                button.id = `btn${key}`;
                button.className = "decision-btn w-full bg-red-600 text-white p-4 rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 text-left space-y-2";
                button.onclick = () => showConsequence(key);
                button.innerHTML = `<span class="font-bold text-lg">${key})</span><span class="block">${decision.text}</span>`;
                buttonsContainer.appendChild(button);
            }
            
            // Hide elements from previous phase and the next phase button
            document.getElementById('consequence-box').classList.add('hidden', 'opacity-0', '-translate-y-4');
            document.getElementById('score-box').classList.add('hidden', 'opacity-0', '-translate-y-4');
            document.getElementById('next-phase-container').classList.add('hidden');
            document.getElementById('final-page').classList.add('hidden');
        }
        
        function loadNextPhase() {
            currentPhaseIndex++;
            if (currentPhaseIndex < gamePhases.length) {
                loadPhase(currentPhaseIndex);
            }
        }

        function restartGame() {
            currentPhaseIndex = 0;
            totalTimeLost = 0;
            totalDeceased = 0;
            totalUnknown = 0;
            totalExternalDeceased = 0;
            correctDecisionsCount = 0;
            document.getElementById('simulation-page').classList.add('hidden');
            document.getElementById('final-page').classList.add('hidden');
            document.getElementById('start-page').classList.remove('hidden');
        }
        
        function startSimulation() {
            document.getElementById('start-page').classList.add('hidden');
            document.getElementById('simulation-page').classList.remove('hidden');
            loadPhase(0);
        }

        // Initial load
        window.onload = () => {
            document.getElementById('simulation-page').classList.add('hidden');
            document.getElementById('final-page').classList.add('hidden');
            document.getElementById('start-page').classList.remove('hidden');
        };
    </script>
    <div id="fullscreen-image-overlay" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.95);justify-content:center;align-items:center;">
      <img id="fullscreen-phase-image" src="" alt="Phase Image" style="max-width:100vw;max-height:100vh;">
    </div>
</body>
</html>
